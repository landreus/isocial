<html>
<head>
    <script type="text/javascript" src="lib/jquery-1.11.0.js"></script>
    <script type="text/javascript" src="lib/sha1.js"></script>
    <script type="text/javascript" src="lib/jsbn.js"></script>
    <script type="text/javascript" src="lib/jsbn2.js"></script>
    <script type="text/javascript" src="routing.js"></script>
</head>

<body>

<div id="data"></div>

<script type="text/javascript">

var getClosestNode = function(keyAsString, rts, own){
    // rts  is the list of routes
    // own is the id of this node with its sha1 hex value
    var key = new BigInteger(keyAsString, 16); // convert the key to BigInteger
    var cand = own; // this node is the first candidate {id, hex} type
    var rhx = own.hex; // an iterator for the hex value of each route
    var minD = key.xor(rhx); // set the minimum distance to be from this node
    var d = minD; // an iterator for the distance to each route
    console.log("ID: " + cand.id + " HEX: " + cand.hex.toString(16) + " D: " + minD.toString(16));
    for(var i = 0; i < rts.length; i ++){
        rhx = rts[i].hex; // obtain this route in hex
        d = key.xor(rhx); // compute the xor to the key
        console.log("ID: " + rts[i].id + " HEX: " + rts[i].hex.toString(16) + " D: " + d.toString(16));
        if(minD.compareTo(d)>0){
            // it means that d is smaller than minD
            minD = d;      // update the minimum distance
            cand = rts[i]; // assign the new candidate
        }
    }
    // return the most suitable candidate
    return cand;
};

$(document).ready(function(){

var ownId = {id: 'feennouqu395p6fy', hex: new BigInteger("385d3b9ae58b21c34ca4c7ad3a8c15e32e3362c7", 16)};
console.log("This node's id and hex: ");
console.log("ID: " + ownId.id + " HEX: " + ownId.hex.toString(16));
//

var data = {
    name: "John Smith",
    comment: "This project is starting to take off!"
};

var value = JSON.stringify(data, null, 2);
var key = Sha1.hash(value);

console.log("key   : " + key);
console.log("value : " + value);

// obtain the node that should store this key-value pair
var node = getClosestNode(key, routes, ownId);
console.log("Selected node: ");
console.log(node.id + " : " + node.hex.toString(16));

});
</script>
</body>
</html>